---
title: "GDELT Tone Mapping"
author: "Tim Gabriel"
date: "2024-04-15"
output: html_document
---

```{r, echo=FALSE}
library(GDELTtools)
library(dplyr)
library(urltools)
library(readxl)
```

# Access dataset for one day

```{r}
apr14 <- GetGDELT("2024-04-14")
apr14
```
# Gather all mentions of an event, Find Average Tone, Pull URL domain

```{r}
apr14 %>% group_by(SOURCEURL, ActionGeo_Lat, ActionGeo_Long, EventRootCode) %>%
  summarise(n(),mean(AvgTone)) %>%
  mutate(domain = (domain(SOURCEURL))) -> df1
df1
```

# Sort these mentions by their country of origin.

```{r}
countryDomains <- read_excel("countryDomains.xlsx")
df1 %>% ungroup() %>%
  select(`n()`, domain, `mean(AvgTone)`) %>% 
  mutate(suffix = sub(".+\\.", ".", domain)) %>%
  left_join(countryDomains, by = c("suffix"="domain")) -> df2
df2
```

# Removing NAs removes majority of rows

```{r}
df2 %>% na.omit() -> df3
df3
```

# Average tone for each country on that day

```{r}
df3 %>% group_by(country) %>% summarise(mean(`mean(AvgTone)`))
```

# Map Average Tone by Country

```{r}
# This average can be converted to a color and each country
# colored according to its overall tone on that event.
```
